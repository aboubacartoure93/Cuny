<% content_for :javascript_includes do %>
  <%= javascript_include_tag "chat2.js" %>
<% end %>

<% content_for :javascript_includes do %>
  <%= javascript_include_tag "students.js" %>
<% end %>

<% content_for :javascript_includes do %>
  <%= javascript_include_tag "create.js.erb" , skip_pipeline: true %>
<% end %>



<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

<script type="text/javascript">

if (location.href.indexOf('reload')==-1)
{
   location.href=location.href+'?reload';
}
</script>  <!-- #reload page for chatbox javascript to load -->





<div class="row">
  <% if current_student[:admin] == true %>
  <!-- Not implemented on tutorial -->
  <div class="col-md-4">
    <div style="height: 300px; overflow-y: auto;">
      <div class="panel panel-default">
        <!-- Default panel contents -->
        <div class="panel-heading">Registered Students</div>

        <!-- Table -->
        <table class="table">
          <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th></th>
          </tr>
          </thead>
          <tbody>
          <% @students.each_with_index do |student, index| %>
              <tr>
                <td><%= index +=1 %></td>
                  <% if student.name.blank? %>
                    <td><%= student.email[0...18] %></td>
                  <% else %>  
                    <td><%= student.name %></td>
                  <% end %>
                <td>
                  <%= link_to "Send Message", "#", class: "btn btn-success btn-xs start-conversationSimple",
                              "data-sid" => current_student.id, "data-rip" => student.id %>
                </td>
              </tr>
          <% end %>

          </tbody>
        </table>
      </div>

    </div>
    <hr>
    <% end %>
    <h3>Your Conversations</h3>

    <div style="height: 400px; overflow-y: auto;">
      <% if @conversations.any? %>
          <ul class="media-list">
            <% @conversations.each do |conversation| %>
                <li class="media">
                  <%= image_tag("http://placehold.it/50x50", class: "media-object pull-left") %>
                  <div class="media-body">
                    <%= link_to "", conversation_path(conversation), class: "conversation", "data-cid" => conversation.id %>
                  
                  <% if  conversation_interlocutor(conversation).present? %>
                    <% if conversation_interlocutor(conversation).pseudo.nil? %>
                      <h4 class="media-heading"><%= conversation_interlocutor(conversation).email %></h4>
                    <% else %>
                      <h4 class="media-heading"><%= conversation_interlocutor(conversation).pseudo %></h4>
                    <% end %>
                  <% else %>
                          <%= "user delete his or her account"%>
                  <% end %>

                        <p><%= conversation.messages.last.nil? ? "No messages" : truncate(conversation.messages.last.body, length: 45) %></p>
                  </div>
                </li>

            <% end %>
          </ul>
      <% else %>
          <p>You have no conversations. Click send message with any user to create one.</p>
      <% end %>
    </div>

  </div>

  <div class="col-md-4">

  </div>

</div>